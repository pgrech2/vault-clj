<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>vault.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Vault-clj</span> <span class="project-version">0.7.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vault</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></div></li><li class="depth-3 branch"><a href="vault.client.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-3"><a href="vault.client.mock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mock</span></div></a></li><li class="depth-2 branch current"><a href="vault.core.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="vault.env.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>env</span></div></a></li><li class="depth-2"><a href="vault.lease.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lease</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="vault.core.html#var-Client"><div class="inner"><span>Client</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-authenticate.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>authenticate!</span></div></a></li><li class="depth-2"><a href="vault.core.html#var-status"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>status</span></div></a></li><li class="depth-1"><a href="vault.core.html#var-LeaseManager"><div class="inner"><span>LeaseManager</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-add-lease-watch"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>add-lease-watch</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-list-leases"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>list-leases</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-remove-lease-watch"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>remove-lease-watch</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-renew-lease"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>renew-lease</span></div></a></li><li class="depth-2"><a href="vault.core.html#var-revoke-lease.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>revoke-lease!</span></div></a></li><li class="depth-1"><a href="vault.core.html#var-new-client"><div class="inner"><span>new-client</span></div></a></li><li class="depth-1"><a href="vault.core.html#var-SecretClient"><div class="inner"><span>SecretClient</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-delete-secret.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>delete-secret!</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-list-secrets"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>list-secrets</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-read-secret"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>read-secret</span></div></a></li><li class="depth-2"><a href="vault.core.html#var-write-secret.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>write-secret!</span></div></a></li><li class="depth-1"><a href="vault.core.html#var-TokenManager"><div class="inner"><span>TokenManager</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-create-token.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>create-token!</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-lookup-accessor"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lookup-accessor</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-lookup-token"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lookup-token</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-renew-token"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>renew-token</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-revoke-accessor.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>revoke-accessor!</span></div></a></li><li class="depth-2"><a href="vault.core.html#var-revoke-token.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>revoke-token!</span></div></a></li><li class="depth-1"><a href="vault.core.html#var-WrappingClient"><div class="inner"><span>WrappingClient</span></div></a></li><li class="depth-2 branch"><a href="vault.core.html#var-unwrap.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>unwrap!</span></div></a></li><li class="depth-2"><a href="vault.core.html#var-wrap.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wrap!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">vault.core</h1><div class="doc"><div class="markdown"><p>Core protocols for interacting with the Vault API.</p></div></div><div class="public anchor" id="var-Client"><h3>Client</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>General protocol for interacting with Vault.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-authenticate.21"><h3>authenticate!</h3><div class="usage"><code>(authenticate! client auth-type credentials)</code></div><div class="doc"><div class="markdown"><p>Updates the client’s internal state by authenticating with the given credentials. Possible arguments:</p>
<ul>
  <li><code>:token "..."</code></li>
  <li><code>:wrap-token "..."</code></li>
  <li><code>:userpass {:username "user", :password "hunter2"}</code></li>
  <li><code>:ldap {:username "LDAP username", :password "hunter2"}</code></li>
  <li><code>:k8s {:jwt "...", :role "..."}</code></li>
  <li><code>:app-id {:app "foo-service-dev", :user "..."}</code></li>
  <li>`:app-role {:role-id “…”, :secret-id “…”}</li>
</ul></div></div></div><div class="public anchor" id="var-status"><h3>status</h3><div class="usage"><code>(status client)</code></div><div class="doc"><div class="markdown"><p>Returns the health status of the Vault server.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/amperity/vault-clj/blob/master/src/vault/core.clj#L9">view source</a></div></div><div class="public anchor" id="var-LeaseManager"><h3>LeaseManager</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Lease management for dynamic secrets.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-add-lease-watch"><h3>add-lease-watch</h3><div class="usage"><code>(add-lease-watch client watch-key path watch-fn)</code></div><div class="doc"><div class="markdown"><p>Registers a new watch function which will be called whenever the lease for the secret at the given path is updated. The <code>watch-key</code> must be unique per client, and can be used to remove the watch later.</p>
<p>The watch function will be called with the secret lease information whenever the lease-id changes. This can be because the secret was rotated, revoked, or expired. In the latter two cases, the function will be called with <code>nil</code> as the argument.</p></div></div></div><div class="public anchor" id="var-list-leases"><h3>list-leases</h3><div class="usage"><code>(list-leases client)</code></div><div class="doc"><div class="markdown"><p>Lists the currently leased secrets this client knows about. Does not return secret data.</p></div></div></div><div class="public anchor" id="var-remove-lease-watch"><h3>remove-lease-watch</h3><div class="usage"><code>(remove-lease-watch client watch-key)</code></div><div class="doc"><div class="markdown"><p>Removes the watch function registered with the given key, if any.</p></div></div></div><div class="public anchor" id="var-renew-lease"><h3>renew-lease</h3><div class="usage"><code>(renew-lease client lease-id)</code></div><div class="doc"><div class="markdown"><p>Renews the identified secret lease. Returns a map containing the extended <code>:lease-duration</code> and whether the lease is <code>:renewable</code>.</p></div></div></div><div class="public anchor" id="var-revoke-lease.21"><h3>revoke-lease!</h3><div class="usage"><code>(revoke-lease! client lease-id)</code></div><div class="doc"><div class="markdown"><p>Revokes the identified secret lease. Returns nil on success.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/amperity/vault-clj/blob/master/src/vault/core.clj#L101">view source</a></div></div><div class="public anchor" id="var-new-client"><h3>new-client</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Constructs a new Vault client from a URI by dispatching on the scheme. The client will be returned in an initialized but not started state.</p></div></div><div class="src-link"><a href="https://github.com/amperity/vault-clj/blob/master/src/vault/core.clj#L187">view source</a></div></div><div class="public anchor" id="var-SecretClient"><h3>SecretClient</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Basic API for listing, reading, and writing secrets.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-delete-secret.21"><h3>delete-secret!</h3><div class="usage"><code>(delete-secret! client path)</code></div><div class="doc"><div class="markdown"><p>Removes secret data from a path. Returns a boolean indicating whether the deletion was successful.</p></div></div></div><div class="public anchor" id="var-list-secrets"><h3>list-secrets</h3><div class="usage"><code>(list-secrets client path)</code></div><div class="doc"><div class="markdown"><p>List the secrets located under a path.</p></div></div></div><div class="public anchor" id="var-read-secret"><h3>read-secret</h3><div class="usage"><code>(read-secret client path)</code><code>(read-secret client path opts)</code></div><div class="doc"><div class="markdown"><p>Reads a secret from a path. Returns the full map of stored secret data if the secret exists, or throws an exception if not.</p>
<p>Additional options may include:</p>
<ul>
  <li><code>:not-found</code>  If the requested path is not found, return this value instead of throwing  an exception.</li>
  <li><code>:renew</code>  Whether or not to renew this secret when the lease is near expiry.</li>
  <li><code>:rotate</code>  Whether or not to rotate this secret when the lease is near expiry and  cannot be renewed.</li>
  <li><code>:force-read</code>  Force the secret to be read from the server even if there is a valid lease cached.</li>
</ul></div></div></div><div class="public anchor" id="var-write-secret.21"><h3>write-secret!</h3><div class="usage"><code>(write-secret! client path data)</code></div><div class="doc"><div class="markdown"><p>Writes secret data to a path. <code>data</code> should be a map. Returns a boolean indicating whether the write was successful.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/amperity/vault-clj/blob/master/src/vault/core.clj#L134">view source</a></div></div><div class="public anchor" id="var-TokenManager"><h3>TokenManager</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Token management interface supported by the “token” auth backend.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-create-token.21"><h3>create-token!</h3><div class="usage"><code>(create-token! client opts)</code></div><div class="doc"><div class="markdown"><p>Creates a new token. With no arguments, this creates a child token that inherits the policies and settings from the current token. Options passed in the map may include:</p>
<ul>
  <li><code>:id</code> The ID of the client token. Can only be specified by a root token.  Otherwise, the token ID is a randomly generated UUID.</li>
  <li><code>:display-name</code> The display name of the token. Defaults to “token”.</li>
  <li><code>:meta</code> Map of string metadata to attach to the token. This will appear  in the audit logs.</li>
  <li><code>:no-parent</code> If true and set by a root caller, the token will not have  the parent token of the caller. This creates a token with no parent.</li>
  <li><code>:policies</code> Set of policies to issue the token with. This must be a  subset of the current token’s policies, unless it is a root token.</li>
  <li><code>:no-default-policy</code> If true the default policy will not be contained in  this token’s policy set.</li>
  <li><code>:num-uses</code> The maximum uses for the given token. This can be used to  create a one-time-token or limited use token. Defaults to 0, which has no  limit to the number of uses.</li>
  <li><code>:renewable</code> Boolean indicating whether the token should be renewable.</li>
  <li><code>:ttl</code> The TTL period of the token, provided as “1h”, where hour is the  largest suffix. If not provided, the token is valid for the default lease  TTL, or indefinitely if the root policy is used.</li>
  <li><code>:explicit-max-ttl</code> If set, the token will have an explicit max TTL set  upon it. This maximum token TTL cannot be changed later, and unlike with  normal tokens, updates to the system/mount max TTL value will have no  effect at renewal time – the token will never be able to be renewed or  used past the value set at issue time.</li>
  <li><code>:wrap-ttl</code> Returns a wrapped response with a wrap-token valid for the  given number of seconds.</li>
</ul></div></div></div><div class="public anchor" id="var-lookup-accessor"><h3>lookup-accessor</h3><div class="usage"><code>(lookup-accessor client token-accessor)</code></div><div class="doc"><div class="markdown"><p>Fetch the properties of the token associated with the accessor, except the token ID. This is meant for purposes where there is no access to token ID but there is need to fetch the properties of a token.</p></div></div></div><div class="public anchor" id="var-lookup-token"><h3>lookup-token</h3><div class="usage"><code>(lookup-token client)</code><code>(lookup-token client token)</code></div><div class="doc"><div class="markdown"><p>Returns information about the given token, or the client token if not specified.</p></div></div></div><div class="public anchor" id="var-renew-token"><h3>renew-token</h3><div class="usage"><code>(renew-token client)</code><code>(renew-token client token)</code></div><div class="doc"><div class="markdown"><p>Renews a lease associated with a token. Returns the renewed auth information. If <code>token</code> is not provided, this renews the client’s own auth token and updates the internal client authentication state.</p>
<p>This is used to prevent the expiration of a token, and the automatic revocation of it. Token renewal is possible only if there is a lease associated with it.</p></div></div></div><div class="public anchor" id="var-revoke-accessor.21"><h3>revoke-accessor!</h3><div class="usage"><code>(revoke-accessor! client token-accessor)</code></div><div class="doc"><div class="markdown"><p>Revoke the token associated with the accessor and all the child tokens. This is meant for purposes where there is no access to token ID but there is need to revoke a token and its children.</p></div></div></div><div class="public anchor" id="var-revoke-token.21"><h3>revoke-token!</h3><div class="usage"><code>(revoke-token! client)</code><code>(revoke-token! client token)</code></div><div class="doc"><div class="markdown"><p>Revokes a token and all child tokens. When the token is revoked, all secrets generated with it are also revoked.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/amperity/vault-clj/blob/master/src/vault/core.clj#L30">view source</a></div></div><div class="public anchor" id="var-WrappingClient"><h3>WrappingClient</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Secret wrapping API for exchanging limited-use tokens for wrapped data.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-unwrap.21"><h3>unwrap!</h3><div class="usage"><code>(unwrap! client wrap-token)</code></div><div class="doc"><div class="markdown"><p>Returns the original response wrapped by the given token.</p></div></div></div><div class="public anchor" id="var-wrap.21"><h3>wrap!</h3><div class="usage"><code>(wrap! client data ttl)</code></div><div class="doc"><div class="markdown"><p>Wraps the given user data in a single-use wrapping token. The wrap token will be valid for <code>ttl</code> seconds and a single use.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/amperity/vault-clj/blob/master/src/vault/core.clj#L171">view source</a></div></div></div></body></html>